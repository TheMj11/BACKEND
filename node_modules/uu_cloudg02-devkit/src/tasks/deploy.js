"use strict";

const Environment = require("../environment.js");
const AppBoxClient = require("../client/app-box");

module.exports = async function (environment, ...args) {
  let env = new Environment(environment, ...args);
  let isLibrary;
  let uuAppBoxUriArg = env.getArgumentValue("uuAppBoxUri");
  let uuAppBox;
  if (uuAppBoxUriArg) {
    const appBoxClient = new AppBoxClient(env, { baseUri: AppBoxClient.getBaseUri(uuAppBoxUriArg) });
    uuAppBox = await appBoxClient.get(uuAppBoxUriArg);
    isLibrary = /^uu5library/.test(uuAppBox?.data?.deliverySpecType);
  } else {
    let projectPackageJson = env.getPackageConfig();
    isLibrary = projectPackageJson?.name?.includes("~root");
  }
  if (isLibrary) return require("./_deploy-lib.js")({ uuAppBox }, environment, ...args);
  return require("./_deploy-app.js")({ uuAppBox }, environment, ...args);
};
