"use strict";

const OidcClient = require("./oidc-client.js");
const UuAppClient = require("./uu-app-client.js");
const DevkitBaseError = require("../errors/devkit-base-error.js");

class CloudClient {

  constructor(environment, opts, entity) {
    let verifySsl = (opts && opts.verifySsl !== undefined) ? opts.verifySsl : (environment.getArgumentValue("verifySsl") !== "false");
    let baseUri = (opts && opts.baseUri) || environment.getArgumentValue("uuCloudUniverseBaseUri") || environment.getDevkitConfig()["uuCloudUniverseBaseUri"] || "UNDEFINED";
    if (!baseUri || baseUri === "UNDEFINED") {
      throw new DevkitBaseError("Missing parameter: uuCloudUniverseBaseUri");
    }
    let oidcClient = new OidcClient(environment, opts);
    this._appClient = new UuAppClient({baseUri, oidcClient, entity, verifySsl});
  }

  _getUseCaseUrl(useCase, parameters = null) {
    return this._appClient.getCommandUrl(useCase, parameters);
  }

  async _get(useCase, parameters = null) {
    return this._appClient.get(useCase, parameters);
  }

  async _post(useCase, parameters = null) {
    return this._appClient.post(useCase, parameters);
  }

  async _upload(useCase, parameters = null) {
    return this._appClient.upload(useCase, parameters);
  }

  async _download(useCase, parameters = null) {
    return this._appClient.download(useCase, parameters);
  }

}

module.exports = CloudClient;
