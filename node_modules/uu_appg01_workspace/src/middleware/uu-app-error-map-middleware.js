"use strict";

const { UseCaseContext } = require("uu_appg01_core-appserver");

const MIDDLEWARE_NAME = "uuAppErrorMapMiddleware";
const MIDDLEWARE_ORDER = 300;

// TODO remove this middleware after adding support of uuAppErrorMap on UseCaseContext in uuAppServer
class uuAppErrorMapMiddleware {
  constructor() {
    this.name = MIDDLEWARE_NAME;
    this.order = MIDDLEWARE_ORDER;
  }

  async post(req, res, next) {
    const uuAppErrorMap = UseCaseContext.getAttribute("uuAppErrorMap");
    if (uuAppErrorMap) {
      let body = res.locals.response.getBody();
      if (body?.uuAppErrorMap) {
        Object.assign(body.uuAppErrorMap, uuAppErrorMap);
      }
    };
    next();
  }
}

module.exports = uuAppErrorMapMiddleware;
