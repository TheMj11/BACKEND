"use strict";

const Sys = require("./sys.js");
const Cp = require("child_process");

const PackagesHelper = require("../utils/packages-helper.js");

/**
 * Provides information about server runtime environment.
 */
class GetEnvironment {

  static async call(ucEnv) {
    Sys.authorize(ucEnv);
    let response = Object.assign({}, Sys.getAppInfo());
    let runtimeStack = process.env["UU_CLOUD_RUNTIME_STACK_CODE"];
    if (!runtimeStack) runtimeStack = `Node ${process.version}`;
    response.runtimeStack = runtimeStack;
    let [libraryList, errorMap] = await PackagesHelper.getUuAppPackages();
    response.libraryList = libraryList;
    response.environmentVariables = process.env;
    response.uuAppErrorMap = errorMap || {};
    return response;
  }

}

module.exports = GetEnvironment;
