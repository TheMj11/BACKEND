"use strict";
const { LoggerMDC } = require("uu_appg01_core-logging");
const UseCaseContext = require("../endpoint/use-case-context.js");

const MIDDLEWARE_ORDER = Number.MIN_SAFE_INTEGER;

/**
 * Initializes logger MDC and use case invocation context.
 */
class UcContextHandler {
  constructor() {
    this.doNotLog = true;
    this.order = MIDDLEWARE_ORDER;
  }

  pre(req, res, next) {
    LoggerMDC.create([req, res, res.socket], () => {
      UseCaseContext.create([req, res, res.socket], () => {
        next();
      });
    });
  }
}

/**
 * Module exports use case invocation context handler.
 * @type {UcContextHandler}
 */
module.exports = UcContextHandler;
